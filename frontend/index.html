<!doctype html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KU Credit Tracker</title>
  <style>
    :root{
      /* KU-ish palette */
      --ku-green: #006A4E;
      --ku-green-2: #0B7D5B;
      --ku-gold: #C9A227;
      --bg: #F6F7F8;
      --card: #FFFFFF;
      --text: #1F2937;
      --muted: #6B7280;
      --border: #E5E7EB;
      --danger: #B91C1C;
      --shadow: 0 10px 25px rgba(0,0,0,.08);
      --radius: 16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", sans-serif;
      color:var(--text);
      background:var(--bg);
    }
    a{color:inherit; text-decoration:none}
    .app{
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }

    /* Topbar */
    .topbar{
      background:linear-gradient(135deg,var(--ku-green), #004C38);
      color:white;
      padding:18px 18px;
      box-shadow: var(--shadow);
    }
    .topbar .row{
      max-width:1100px;
      margin:0 auto;
      display:flex;
      align-items:center;
      gap:14px;
      justify-content:space-between;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
    }
    .logo{
      width:40px; height:40px; border-radius:12px;
      background: radial-gradient(circle at 30% 30%, var(--ku-gold), #8B6B12);
      box-shadow: inset 0 0 0 3px rgba(255,255,255,.15);
      position:relative;
    }
    .logo::after{
      content:"KU";
      position:absolute; inset:0;
      display:flex; align-items:center; justify-content:center;
      font-weight:900; letter-spacing:.5px;
      color:#0b3b2c;
    }
    .brand h1{
      margin:0; font-size:16px; line-height:1.2;
      font-weight:800;
    }
    .brand p{
      margin:0; font-size:12px; color:rgba(255,255,255,.8)
    }
    .top-actions{
      display:flex; gap:10px; align-items:center;
    }
    .chip{
      padding:8px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.18);
      font-size:12px;
    }
    .btn{
      border:none; cursor:pointer;
      padding:10px 12px;
      border-radius:12px;
      font-weight:700;
      background: var(--ku-gold);
      color:#1b1401;
      box-shadow: 0 10px 20px rgba(201,162,39,.25);
      transition: transform .05s ease;
    }
    .btn:active{transform: translateY(1px)}
    .btn.secondary{
      background: rgba(255,255,255,.12);
      color:white;
      border:1px solid rgba(255,255,255,.25);
      box-shadow:none;
    }
    .btn.danger{
      background: #fee2e2;
      color: var(--danger);
      border:1px solid #fecaca;
      box-shadow:none;
    }

    /* Layout */
    .main{
      max-width:1100px;
      width:100%;
      margin:18px auto;
      padding:0 18px 24px;
      display:grid;
      grid-template-columns: 260px 1fr;
      gap:16px;
    }
    @media (max-width: 920px){
      .main{grid-template-columns: 1fr}
    }

    /* Sidebar */
    .sidebar{
      background:var(--card);
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:12px;
      position: sticky;
      top: 14px;
      height: fit-content;
    }
    .profile{
      padding:10px;
      border-radius: 14px;
      background: linear-gradient(180deg, rgba(0,106,78,.08), rgba(201,162,39,.08));
      border:1px dashed rgba(0,106,78,.2);
      margin-bottom:10px;
    }
    .profile .name{font-weight:900}
    .profile .meta{font-size:12px; color:var(--muted); margin-top:2px}
    .nav{
      display:flex; flex-direction:column; gap:6px;
    }
    .nav button{
      width:100%;
      text-align:left;
      background:transparent;
      border:1px solid transparent;
      padding:10px 10px;
      border-radius: 12px;
      cursor:pointer;
      font-weight:700;
      color: #0f2f25;
      display:flex; align-items:center; justify-content:space-between;
    }
    .nav button:hover{background: rgba(0,106,78,.06)}
    .nav button.active{
      background: rgba(0,106,78,.10);
      border-color: rgba(0,106,78,.18);
    }
    .nav small{color:var(--muted); font-weight:600}

    /* Content cards */
    .content{
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:16px;
    }
    .card h2{
      margin:0 0 10px 0;
      font-size:18px;
    }
    .sub{
      margin:0 0 14px 0;
      color:var(--muted);
      font-size:13px;
    }

    /* Dashboard grid */
    .stats{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:12px;
    }
    @media (max-width: 720px){ .stats{grid-template-columns: 1fr} }
    .stat{
      border-radius: 14px;
      border:1px solid var(--border);
      padding:12px;
      background: linear-gradient(180deg, rgba(0,106,78,.06), rgba(255,255,255,0));
    }
    .stat .label{font-size:12px; color:var(--muted); font-weight:700}
    .stat .value{font-size:26px; font-weight:900; margin-top:6px}
    .stat .hint{font-size:12px; color:var(--muted); margin-top:4px}

    .progress-wrap{
      margin-top:14px;
      border:1px solid var(--border);
      border-radius: 14px;
      padding:12px;
      background: linear-gradient(180deg, rgba(201,162,39,.08), rgba(255,255,255,0));
    }
    .progress-top{
      display:flex; align-items:flex-end; justify-content:space-between; gap:10px;
      margin-bottom:10px;
    }
    .progress-top .title{font-weight:900}
    .progress{
      height:12px;
      border-radius:999px;
      background:#EEF2F7;
      border:1px solid var(--border);
      overflow:hidden;
    }
    .bar{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--ku-green), var(--ku-green-2), var(--ku-gold));
      transition: width 0.4s ease;
    }
    .cat-grid{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap:12px;
      margin-top:12px;
    }
    @media (max-width: 720px){ .cat-grid{grid-template-columns: 1fr} }
    .cat{
      border:1px solid var(--border);
      border-radius: 14px;
      padding:12px;
      background:#fff;
    }
    .cat .row{
      display:flex; justify-content:space-between; align-items:center;
      gap:10px;
      margin-bottom:8px;
    }
    .pill{
      font-size:12px;
      padding:5px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(0,106,78,.06);
      color:#064333;
      font-weight:800;
    }
    .pill.warn{
      background: rgba(201,162,39,.10);
      color:#5a460b;
      border-color: rgba(201,162,39,.25);
    }
    .mini{
      font-size:12px;
      color:var(--muted);
    }

    /* Tables & forms */
    .grid-2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 720px){ .grid-2{grid-template-columns:1fr} }

    label{font-size:12px; color:var(--muted); font-weight:800; display:block; margin-bottom:6px}
    input, select, textarea{
      width:100%;
      padding:10px 10px;
      border-radius: 12px;
      border:1px solid var(--border);
      outline:none;
      font-size:14px;
      background:#fff;
    }
    textarea{min-height:90px; resize:vertical}
    .form-actions{display:flex; gap:10px; margin-top:12px; flex-wrap:wrap}
    .btn.ghost{
      background:#fff;
      border:1px solid var(--border);
      box-shadow:none;
      color:var(--text);
    }

    table{
      width:100%;
      border-collapse: collapse;
      overflow:hidden;
      border-radius: 14px;
      border:1px solid var(--border);
    }
    th, td{
      padding:10px;
      border-bottom:1px solid var(--border);
      font-size:13px;
      text-align:left;
      vertical-align:top;
    }
    th{background: rgba(0,106,78,.06); font-weight:900}
    tr:last-child td{border-bottom:none}
    .row-actions{display:flex; gap:8px; flex-wrap:wrap}
    .tag{
      display:inline-block;
      font-size:12px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid var(--border);
      background:#fff;
      color:var(--muted);
      font-weight:800;
    }
    .tag.core{background: rgba(0,106,78,.08); color:#064333; border-color: rgba(0,106,78,.20)}
    .tag.major{background: rgba(201,162,39,.12); color:#5a460b; border-color: rgba(201,162,39,.28)}
    .tag.free{background: rgba(59,130,246,.10); color:#1e3a8a; border-color: rgba(59,130,246,.22)}

    /* Auth */
    .auth-wrap{
      max-width: 900px;
      margin: 18px auto;
      padding: 0 18px 24px;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:16px;
    }
    @media (max-width: 920px){ .auth-wrap{grid-template-columns:1fr} }

    .hero{
      background: linear-gradient(135deg, rgba(0,106,78,.12), rgba(201,162,39,.12));
      border:1px solid rgba(0,106,78,.18);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:18px;
      position:relative;
      overflow:hidden;
    }
    .hero::before{
      content:"";
      position:absolute;
      right:-80px; top:-80px;
      width:200px; height:200px;
      background: radial-gradient(circle, rgba(201,162,39,.35), rgba(201,162,39,0));
      transform: rotate(12deg);
    }
    .hero h2{margin:0 0 8px 0; font-size:22px}
    .hero p{margin:0; color:var(--muted); line-height:1.55}
    .hero ul{margin:12px 0 0 18px; color:var(--muted)}
    .toggle{
      display:flex; gap:8px; margin-top:12px; flex-wrap:wrap
    }
    .toggle .btn{padding:10px 14px}
    .footer{
      max-width:1100px;
      width:100%;
      margin: 0 auto 18px;
      padding: 0 18px;
      color:var(--muted);
      font-size:12px;
    }

    .hidden{display:none !important}
  </style>
</head>

<body>
  <div class="app">
    <header class="topbar">
      <div class="row">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <h1>KU Credit Tracker</h1>
            <p>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï & ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (Integrated with Backend)</p>
          </div>
        </div>
        <div class="top-actions">
          <span class="chip" id="envChip">Online</span>
        </div>
      </div>
    </header>

    <section class="auth-wrap" id="pageAuth">
      <div class="hero">
        <h2>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà KU Credit Tracker</h2>
        <p>‡πÄ‡∏ß‡πá‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ ‚Äú‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏∞‡πÑ‡∏£‡πÅ‡∏•‡πâ‡∏ß / ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£‚Äù ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Backend ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
        <ul>
          <li>Dashboard ‡∏™‡∏£‡∏∏‡∏õ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï + progress bar (‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á)</li>
          <li>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£</li>
          <li>‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API Backend 100%</li>
        </ul>
        <div class="toggle">
          <button class="btn" onclick="demoLogin()">Login (Demo Data Account)</button>
        </div>
      </div>

      <div class="card" id="authCard">
        <h2 id="authTitle">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
        <p class="sub" id="authSub">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>

        <div class="grid-2">
          <div>
            <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏• ‡∏´‡∏£‡∏∑‡∏≠ ‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏¥‡∏™‡∏¥‡∏ï</label>
            <input id="email" placeholder="‡πÄ‡∏ä‡πà‡∏ô s65xxxxxx@ku.th" />
          </div>
          <div>
            <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
            <input id="password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
          </div>
        </div>

        <div class="form-actions" id="authActionBox">
          <button class="btn" id="authPrimary" onclick="handleAuthAction()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
          <button class="btn ghost" id="authSecondary" onclick="toggleAuthMode()">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button>
        </div>
      </div>
    </section>

    <section class="main hidden" id="pageApp">
      <aside class="sidebar">
        <div class="profile">
          <div class="name">‡∏ô‡∏¥‡∏™‡∏¥‡∏ï: <span id="pName"></span></div>
          <div class="meta">‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£ <span id="pVersionText">2026</span></div>
        </div>

        <div class="nav">
          <button class="active" data-view="dashboard" onclick="setView('dashboard', this)">
            Dashboard <small>‡∏™‡∏£‡∏∏‡∏õ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï</small>
          </button>
          <button data-view="addCourse" onclick="setView('addCourse', this)">
            ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô <small>Completed</small>
          </button>
          <button data-view="remaining" onclick="setView('remaining', this)">
            ‡∏î‡∏π‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ <small>Remaining</small>
          </button>
          <button data-view="studyPlan" onclick="setView('studyPlan', this)">
            ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Study Plan <small>CRUD</small>
          </button>
        </div>

        <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap">
          <button class="btn danger" onclick="doLogout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
      </aside>

      <main class="content">
        <section class="card" id="view_dashboard">
          <h2>Dashboard ‚Äî ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï</h2>
          <p class="sub">‡∏™‡∏£‡∏∏‡∏õ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï‡∏™‡∏∞‡∏™‡∏° (‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏ú‡πà‡∏≤‡∏ô API MongoDB)</p>

          <div class="stats">
            <div class="stat">
              <div class="label">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï‡∏™‡∏∞‡∏™‡∏° (Earned)</div>
              <div class="value" id="stEarned">0</div>
              <div class="hint">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å completed courses</div>
            </div>
            <div class="stat">
              <div class="label">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏£‡∏ö (Required)</div>
              <div class="value" id="stRequired">0</div>
              <div class="hint">‡∏°‡∏≤‡∏à‡∏≤‡∏Å Study Plan</div>
            </div>
            <div class="stat">
              <div class="label">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (Remaining)</div>
              <div class="value" id="stRemaining">0</div>
              <div class="hint">Required - Earned (‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î)</div>
            </div>
          </div>

          <div class="progress-wrap">
            <div class="progress-top">
              <div>
                <div class="title">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏ß‡∏°</div>
                <div class="mini"><span id="pctText">0</span>% ‡∏Ç‡∏≠‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</div>
              </div>
              <span class="pill" id="statusPill">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
            </div>
            <div class="progress" aria-label="progress bar">
              <div class="bar" id="bar"></div>
            </div>

            <div class="cat-grid" id="catGrid"></div>
          </div>
        </section>

        <section class="card hidden" id="view_addCourse">
          <h2>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß (Completed Course)</h2>
          <p class="sub">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>

          <div class="grid-2">
            <div style="grid-column: 1 / -1;">
              <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤ (‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Master)</label>
              <select id="fCourseSelect" onchange="autoFillCourseDetails()">
                <option value="">-- ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏¥‡∏ä‡∏≤ --</option>
              </select>
            </div>
            <div>
              <label>‡∏£‡∏´‡∏±‡∏™‡∏ß‡∏¥‡∏ä‡∏≤</label>
              <input id="fCourseId" placeholder="‡πÄ‡∏ä‡πà‡∏ô 01418112" />
            </div>
            <div>
              <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤</label>
              <input id="fCourseName" placeholder="‡πÄ‡∏ä‡πà‡∏ô Programming I" />
            </div>
            <div>
              <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà (‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ï‡∏≤‡∏° Study Plan)</label>
              <input id="fCategory" placeholder="‡πÄ‡∏ä‡πà‡∏ô Core, Major, Free" />
            </div>
            <div>
              <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï</label>
              <input id="fCredits" type="number" placeholder="‡πÄ‡∏ä‡πà‡∏ô 3" />
            </div>
            <div>
              <label>‡πÄ‡∏Å‡∏£‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ</label>
              <select id="fGrade">
                <option>A</option><option>B+</option><option>B</option><option>C+</option><option>C</option><option>D+</option><option>D</option><option>F</option>
              </select>
            </div>
            <div>
              <label>‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤/‡πÄ‡∏ó‡∏≠‡∏°</label>
              <input id="fTerm" placeholder="1/2026" />
            </div>
          </div>

          <div class="form-actions">
            <button class="btn" onclick="addCompleted()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</button>
          </div>

          <div style="margin-top:14px">
            <h3 style="margin:0 0 10px 0; font-size:15px">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß</h3>
            <table>
              <thead>
                <tr>
                  <th>‡∏ß‡∏¥‡∏ä‡∏≤</th>
                  <th>‡∏´‡∏°‡∏ß‡∏î</th>
                  <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï</th>
                  <th>‡πÄ‡∏Å‡∏£‡∏î</th>
                  <th>‡πÄ‡∏ó‡∏≠‡∏°</th>
                  <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                </tr>
              </thead>
              <tbody id="completedTbody"></tbody>
            </table>
          </div>
        </section>

        <section class="card hidden" id="view_remaining">
          <h2>‡∏î‡∏π‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (Remaining)</h2>
          <p class="sub">‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏°‡∏ß‡∏î‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö + ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°</p>

          <div id="remainingBox">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
        </section>

        <section class="card hidden" id="view_studyPlan">
          <h2>Study Plan (CRUD)</h2>
          <p class="sub">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ú‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏Ç‡∏≠‡∏á‡∏ô‡∏¥‡∏™‡∏¥‡∏ï (‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Schema ‡∏Ç‡∏≠‡∏á Backend)</p>

          <div class="grid-2">
            <div>
              <label>Program (‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£)</label>
              <input id="pProgram" value="Computer Science" />
            </div>
            <div>
              <label>Version (‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á)</label>
              <input id="pVersion" value="2026" />
            </div>
          </div>

          <div style="margin-top:12px" class="grid-2">
            <div>
              <label>Core Required Credits</label>
              <input id="pCore" type="number" value="30" min="0" />
            </div>
            <div>
              <label>Major Required Credits</label>
              <input id="pMajor" type="number" value="45" min="0" />
            </div>
            <div>
              <label>Free Required Credits</label>
              <input id="pFree" type="number" value="6" min="0" />
            </div>
          </div>

          <div class="form-actions">
            <button class="btn" onclick="savePlan()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å / ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Study Plan</button>
            <button class="btn ghost" onclick="loadPlan()">‡πÇ‡∏´‡∏•‡∏î Study Plan ‡∏ã‡πâ‡∏≥</button>
            <button class="btn danger" onclick="softDeletePlan()">‡∏•‡∏ö‡πÅ‡∏ú‡∏ô (Soft Delete)</button>
          </div>

          <div style="margin-top:12px">
            <div class="mini"><b>Mongo Document Preview:</b></div>
            <pre id="planPreview" style="background:#0b1220;color:#e5e7eb;padding:12px;border-radius:14px;overflow:auto;border:1px solid rgba(255,255,255,.06)">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</pre>
          </div>
        </section>
      </main>
    </section>

    <div class="footer">
      ¬© KU Credit Tracker (Backend Variable Matched Version)
    </div>
  </div>

  <script>
    // ==========================================
    // 1. Config & State
    // ==========================================
    const API_BASE = "http://localhost:5000/api";
    
    const state = {
      studentId: localStorage.getItem("studentId") || null,
      coursesMaster: [],
      authMode: 'login'
    };

    // ==========================================
    // 2. Init & Auth
    // ==========================================
    document.addEventListener("DOMContentLoaded", () => {
      if (state.studentId) {
        showApp();
      } else {
        showAuth();
      }
    });

    function showAuth() {
      document.getElementById("pageAuth").classList.remove("hidden");
      document.getElementById("pageApp").classList.add("hidden");
    }

    function showApp() {
      document.getElementById("pageAuth").classList.add("hidden");
      document.getElementById("pageApp").classList.remove("hidden");
      document.getElementById("pName").textContent = state.studentId;
      
      fetchMasterCourses().then(() => {
        refreshAll();
        loadPlan();
      });
    }

    function toggleAuthMode() {
      state.authMode = state.authMode === 'login' ? 'register' : 'login';
      const title = document.getElementById("authTitle");
      const primaryBtn = document.getElementById("authPrimary");
      const secondaryBtn = document.getElementById("authSecondary");

      if(state.authMode === 'register') {
        title.textContent = "‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å";
        primaryBtn.textContent = "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£";
        secondaryBtn.textContent = "‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö";
      } else {
        title.textContent = "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö";
        primaryBtn.textContent = "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö";
        secondaryBtn.textContent = "‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å";
      }
    }

    async function handleAuthAction() {
      if(state.authMode === 'login') await doLogin();
      else await doRegister();
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢ Reset ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á Data ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö /api/demo/reset)
    async function demoLogin() {
      document.getElementById("email").value = "S001";
      document.getElementById("password").value = "demo";
      
      try {
        await fetch(`${API_BASE}/demo/reset`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ studentId: "S001" })
        });
      } catch (err) {
        console.warn("Demo reset API warning:", err);
      }

      await doLogin();
    }

    async function doLogin() {
      const email = document.getElementById("email").value;
      if(!email) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö");
      
      // ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå sXXXXXX@ku.th ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏¥‡∏™‡∏¥‡∏ï‡∏ï‡∏£‡∏á‡πÜ
      state.studentId = email.includes('@') ? email.split('@')[0].toUpperCase() : email.toUpperCase();
      localStorage.setItem("studentId", state.studentId);
      
      try {
        // ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏°‡∏µ users.js ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö /login
        await fetch(`${API_BASE}/users/login`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email: state.studentId })
        });
      } catch(e) {} 

      showApp();
    }

    async function doRegister() {
      const email = document.getElementById("email").value;
      if(!email) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
      
      try {
        await fetch(`${API_BASE}/users/register`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email })
        });
        alert("‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö");
        toggleAuthMode();
      } catch(e) {
        alert("‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (Demo Mode)");
        toggleAuthMode();
      }
    }

    function doLogout() {
      if(!confirm("‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
      localStorage.removeItem("studentId");
      state.studentId = null;
      document.getElementById("email").value = "";
      document.getElementById("password").value = "";
      showAuth();
    }

    // ==========================================
    // 3. UI Routing & Fetchers
    // ==========================================
    function setView(view, btn) {
      document.querySelectorAll(".nav button").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      document.querySelectorAll("[id^='view_']").forEach(v => v.classList.add("hidden"));
      document.getElementById("view_" + view).classList.remove("hidden");
      refreshAll();
    }

    async function refreshAll() {
      await fetchSummary();
      await fetchCompleted();
    }

    async function fetchMasterCourses() {
      try {
        const res = await fetch(`${API_BASE}/courses`);
        if(!res.ok) throw new Error();
        state.coursesMaster = await res.json();
      } catch (err) {
        // Fallback Data ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥ API Master courses
        state.coursesMaster = [
          { courseId: "01418112", courseName: "Programming I", category: "Core", credits: 3 },
          { courseId: "01418113", courseName: "Programming II", category: "Core", credits: 3 },
          { courseId: "01418211", courseName: "Software Engineering", category: "Major", credits: 3 },
          { courseId: "01355112", courseName: "English I", category: "Free", credits: 3 }
        ];
      }

      const select = document.getElementById("fCourseSelect");
      select.innerHTML = `<option value="">-- ‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤ --</option>` + 
        state.coursesMaster.map(c => `<option value="${c.courseId}">${c.courseId} - ${c.courseName}</option>`).join("");
    }

    function autoFillCourseDetails() {
      const val = document.getElementById("fCourseSelect").value;
      const c = state.coursesMaster.find(x => x.courseId === val);
      if(c) {
        document.getElementById("fCourseId").value = c.courseId;
        document.getElementById("fCourseName").value = c.courseName;
        document.getElementById("fCategory").value = c.category;
        document.getElementById("fCredits").value = c.credits;
      }
    }

    // ==========================================
    // 4. Dashboard (Summary Data)
    // ==========================================
    async function fetchSummary() {
      let data = null;
      try {
        const res = await fetch(`${API_BASE}/summary/${state.studentId}`);
        if(!res.ok) throw new Error();
        data = await res.json();
      } catch (err) {
        document.getElementById("statusPill").textContent = "‡πÇ‡∏õ‡∏£‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á Study Plan ‡∏Å‡πà‡∏≠‡∏ô";
        return;
      }

      // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Backend summary.service.ts
      // data.totalCredits
      // data.categories -> [ { category, required, earned, remaining, completed } ]
      
      const totalEarned = data.totalCredits || 0;
      let totalRequired = 0;
      let remainingTotal = 0;

      if (data.categories) {
        data.categories.forEach(c => {
          totalRequired += c.required;
          remainingTotal += c.remaining;
        });
      }

      document.getElementById("stEarned").textContent = totalEarned;
      document.getElementById("stRequired").textContent = totalRequired;
      document.getElementById("stRemaining").textContent = remainingTotal;

      const pct = totalRequired === 0 ? 0 : Math.min(100, Math.round((totalEarned / totalRequired) * 100));
      document.getElementById("pctText").textContent = pct;
      document.getElementById("bar").style.width = pct + "%";
      document.getElementById("statusPill").textContent = pct >= 100 ? "‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡πÅ‡∏•‡πâ‡∏ß üéâ" : "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£";
      document.getElementById("statusPill").className = pct >= 100 ? "pill" : "pill warn";

      const grid = document.getElementById("catGrid");
      grid.innerHTML = (data.categories || []).map(cat => `
        <div class="cat">
          <div class="row">
            <div><div style="font-weight:900">${cat.category}</div><div class="mini">‡πÑ‡∏î‡πâ ${cat.earned} / ‡∏ï‡πâ‡∏≠‡∏á ${cat.required}</div></div>
            ${cat.completed ? `<span class="pill">‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß</span>` : `<span class="pill warn">‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${cat.remaining}</span>`}
          </div>
          <div class="progress" style="height:10px">
            <div class="bar" style="width:${cat.required===0?0:Math.min(100, Math.round((cat.earned/cat.required)*100))}%"></div>
          </div>
        </div>
      `).join("");

      const remBox = document.getElementById("remainingBox");
      const notDone = (data.categories || []).filter(c => !c.completed);
      
      if(notDone.length === 0){
        remBox.innerHTML = `<div class="card" style="box-shadow:none; background: linear-gradient(180deg, rgba(0,106,78,.08), #fff)"><b>‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡πÅ‡∏•‡πâ‡∏ß üéâ</b></div>`;
      } else {
        remBox.innerHTML = notDone.map(c => `
          <div class="card" style="box-shadow:none; margin-bottom:10px">
            <div style="display:flex; justify-content:space-between; gap:10px; align-items:center">
              <div><b>${c.category}</b><div class="mini">‡πÑ‡∏î‡πâ ${c.earned} / ‡∏ï‡πâ‡∏≠‡∏á ${c.required}</div></div>
              <span class="pill warn">‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${c.remaining} ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏¥‡∏ï</span>
            </div>
          </div>
        `).join("");
      }
    }

    // ==========================================
    // 5. Completed Courses (Add / Edit / Delete)
    // ==========================================
    async function fetchCompleted() {
      let rows = [];
      try {
        const res = await fetch(`${API_BASE}/completed-courses/${state.studentId}`);
        if(res.ok) rows = await res.json();
      } catch (err) {}

      const tbody = document.getElementById("completedTbody");
      if(rows.length === 0){
        tbody.innerHTML = `<tr><td colspan="6" class="mini" style="text-align:center;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ä‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß</td></tr>`;
        return;
      }

      tbody.innerHTML = rows.map(c => `
        <tr>
          <td><b>${c.courseId}</b><div class="mini">${c.courseName}</div></td>
          <td><span class="tag">${c.category}</span></td>
          <td>${c.credits}</td>
          <td>${c.grade}</td>
          <td>${c.term}</td>
          <td>
            <div class="row-actions">
              <button class="btn ghost" onclick="updateGrade('${c._id}', '${c.grade}')">‡πÅ‡∏Å‡πâ‡πÄ‡∏Å‡∏£‡∏î</button>
              <button class="btn danger" onclick="softDeleteCourse('${c._id}')">‡∏•‡∏ö</button>
            </div>
          </td>
        </tr>
      `).join("");
    }

    async function addCompleted() {
      // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö `addSchema` ‡πÉ‡∏ô completedCourse.routes.js ‡πÅ‡∏ö‡∏ö‡πÄ‡∏õ‡πä‡∏∞‡πÜ 7 ‡∏ï‡∏±‡∏ß
      const courseId = document.getElementById("fCourseId").value;
      const courseName = document.getElementById("fCourseName").value;
      const category = document.getElementById("fCategory").value;
      // credits ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô Number()
      const credits = Number(document.getElementById("fCredits").value); 
      const grade = document.getElementById("fGrade").value;
      const term = document.getElementById("fTerm").value;

      if(!courseId || !courseName || !category || !term) {
        return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
      }

      const payload = { 
        studentId: state.studentId, 
        courseId, 
        courseName, 
        category, 
        credits, 
        grade, 
        term 
      };

      try {
        const res = await fetch(`${API_BASE}/completed-courses`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        
        if(!res.ok) {
          const errData = await res.json();
          console.error("Zod Validation Error:", errData);
          throw new Error("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á Schema ‡∏Ç‡∏≠‡∏á Backend");
        }

        // ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
        document.getElementById("fCourseSelect").value = "";
        document.getElementById("fCourseId").value = "";
        document.getElementById("fCourseName").value = "";
        document.getElementById("fCategory").value = "";
        document.getElementById("fCredits").value = "";
        document.getElementById("fTerm").value = "";
        
        await refreshAll();
        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
      } catch (err) {
        console.error(err);
        alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ (‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏î‡∏π Console F12)");
      }
    }

    async function updateGrade(id, oldGrade) {
      const newGrade = prompt(`‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏Å‡∏£‡∏î‡πÉ‡∏´‡∏°‡πà:`, oldGrade);
      if(!newGrade) return;

      try {
        const res = await fetch(`${API_BASE}/completed-courses/${id}/grade`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          // ‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏° z.object({ grade: z.string().min(1) })
          body: JSON.stringify({ grade: newGrade.toUpperCase() })
        });
        if(!res.ok) throw new Error("Update failed");
        
        await refreshAll();
      } catch (err) {
        console.error(err);
        alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏Å‡∏£‡∏î‡πÑ‡∏î‡πâ");
      }
    }

    async function softDeleteCourse(id) {
      if(!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?")) return;

      try {
        await fetch(`${API_BASE}/completed-courses/${id}`, { method: "DELETE" });
        await refreshAll();
      } catch (err) {
        console.error(err);
      }
    }

    // ==========================================
    // 6. Study Plan Actions (CRUD)
    // ==========================================
    async function loadPlan() {
      try {
        const res = await fetch(`${API_BASE}/study-plan/${state.studentId}`);
        if(!res.ok) throw new Error();
        const plan = await res.json();

        document.getElementById("pProgram").value = plan.program || "";
        document.getElementById("pVersion").value = plan.version || "";
        document.getElementById("pVersionText").textContent = plan.version || "2026";
        
        // ‡πÅ‡∏°‡∏õ‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏≠‡∏á input
        plan.categories.forEach(cat => {
          if(cat.name === "Core") document.getElementById("pCore").value = cat.requiredCredits;
          if(cat.name === "Major") document.getElementById("pMajor").value = cat.requiredCredits;
          if(cat.name === "Free") document.getElementById("pFree").value = cat.requiredCredits;
        });

        document.getElementById("planPreview").textContent = JSON.stringify(plan, null, 2);
      } catch (err) {
        document.getElementById("planPreview").textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Study Plan ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ô‡∏¥‡∏™‡∏¥‡∏ï‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ";
      }
    }

    async function savePlan() {
      // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö `planSchema` ‡πÉ‡∏ô studyPlan.routes.js ‡πÅ‡∏ö‡∏ö‡πÄ‡∏õ‡πä‡∏∞‡πÜ
      // studentId, program, version, categories: array of {name, requiredCredits}
      const payload = {
        studentId: state.studentId,
        program: document.getElementById("pProgram").value,
        version: document.getElementById("pVersion").value,
        categories: [
          { name: "Core", requiredCredits: Number(document.getElementById("pCore").value) },
          { name: "Major", requiredCredits: Number(document.getElementById("pMajor").value) },
          { name: "Free", requiredCredits: Number(document.getElementById("pFree").value) }
        ]
      };

      try {
        const res = await fetch(`${API_BASE}/study-plan`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        
        if(!res.ok) {
          const errData = await res.json();
          console.error("Zod Validation Error:", errData);
          throw new Error("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á Schema ‡∏Ç‡∏≠‡∏á Backend");
        }
        
        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Study Plan ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
        await loadPlan();
        await refreshAll();
      } catch (err) {
        alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Study Plan ‡πÑ‡∏î‡πâ (‡∏î‡∏π Console F12)");
        console.error(err);
      }
    }

    async function softDeletePlan() {
      if(!confirm("‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö Study Plan ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì?")) return;
      try {
        await fetch(`${API_BASE}/study-plan/${state.studentId}`, { method: "DELETE" });
        alert("‡∏•‡∏ö Study Plan ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
        document.getElementById("planPreview").textContent = "‡πÑ‡∏°‡πà‡∏°‡∏µ Study Plan";
        await refreshAll();
      } catch (err) {
        console.error(err);
      }
    }
  </script>
</body>
</html>
